{% extends '_base.html.twig' %}

{% block main %}
    {% import '_macros.twig' as macros %}

    <h2>{{ page.metadata.title }}</h2>

    {{ page.body|md2html|raw }}

    {% if page.metadata.wikidata is defined %}
        {% set wditem = wikidata( page.metadata.wikidata ) %}
        <p>
          <a href="https://www.wikidata.org/wiki/{{ wditem.id }}">
              <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/Wikidata-logo.svg/20px-Wikidata-logo.svg.png"
                   alt="Small Wikidata logo" />
              {{ wditem.labels.en.value }} ({{ wditem.id }})
          </a>:
            {{ wditem.descriptions.en.value }}
        </p>
    {% endif %}

    <div class="row">
        {% for p in database.query('SELECT p.* FROM pages p, json_each(p.tags) j WHERE "/tags/"||j.value LIKE "'~page.id~'" ORDER BY p.date') %}
            <figure class="figure col-md-2">
                <a href="{{ page.link(p.id) }}.html">
                    {% if p.commons is defined and p.commons %}
                        {% set commons = commons(p.commons) %}
                        <img src="{{ commons.imageinfo.0.thumburl|escape('html_attr') }}" class="figure-img img-fluid rounded" />
                    {% else %}
                        <img src="{{ p.image }}" class="figure-img img-fluid rounded" />
                    {% endif %}
                </a>
                <figcaption class="figure-caption text-center">
                    <a href="{{ page.link(p.id) }}.html">
                        <strong>{{ p.title }}</strong>{% if p.date %},
                            {{ macros.date(p.date, p.date_precision) }}
                        {% endif %}
                    </a>
                </figcaption>
            </figure>
        {% endfor %}

    </div>

{% endblock %}
